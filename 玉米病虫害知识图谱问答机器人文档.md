# 玉米病虫害知识图谱问答机器人文档

## 1.整体构架

​		本项目整体采用Rasa框架一个开源(Python)机器学习框架，用于自动生成基于文本和语音的对话），主要包含4个部分：

- Rasa NLU：提取用户想要做什么和关键的上下文信息
- Rasa Core：基于对话历史，选择最优的回复和动作
- channel和action：连接对话机器人与用户及后端服务系统
- tracker store、lock store和event broker等辅助系统

## 2.Rasa NLU

​		Rasa NLU负责意图提取和实体提取，从结构上Rasa NLU使用有监督算法来完成这一功能，该部分主要使用分词组件、特征提取组件、NER组件和意图分类组件。本项目选用了JiebaTokenizer作为分词组件，CountVectorsFeaturizer（使用的是BOW模型）作为分词组件，DietClassifier作为NER组件和意图分类组件。

​	本案例将用户提问的问题归为两类：

- 用户想要获得某个对象类型的列表

- 用户想要获得对象的某个属性

	在nlu训练数据，本项目共使用三种实体，object_type代表用户查询某一类对象时可能的对象类型，mention表示用户使用的指示代词，如“这个”，“第一个”等，attribute包含图谱中的所有对象和属性（本项目知识图谱中暂无属性，在有属性的知识图谱中也支持查询属性）

## 3. Rasa Core

​		Rasa Core是负责对话管理的部分，用于记录对话过程和选择下一个动作，主要包含domain，story，action，policy几个部分

- domain定义了对话机器人的全部操作。它指定对话机器人的意图、实体、槽、响应、表单和动作。它还定义了对话会话的配置。
- story是一种用于训练对话机器人对话管理模型的训练数据。story可用于训练泛化到未见过的对话路径的模型。
- action是在每个用户消息之后，模型将预测对话机器人接下来应该执行的动作。
- 对话机器人使用policy来决定在对话的每个步骤中要执行的动作。对话机器人可以同时使用机器学习和基于规则的策略。

## 4.查询的工作原理

​		基于知识图谱查询的问答实现主要是通过继承Rasa中的ActionQueryKnowledgeBase并将知识库实例作为参数传入实现的。

​		具体查询原理如下：

### 4.1 对象查询

​		当传入查询的对象的类型后，如“列出玉米[病害](object_type)”，在NLU部分问题中的[病害](object_type)会被映射成“病害”，调用utter_objects()方法这样机器人就会去查询知识图谱中的“病害”知识库，从而列举出其中的实体。而当问题为“[玉米平脐蠕胞茎基腐病](disease)危害哪些[作物](object_type)”，与上个例子相比增加了值为“玉米异跗萤叶甲”的虫害实体作为过滤条件。

### 4.2 属性查询

​		例如“可以告诉我[玉米细菌性茎腐病](disease)的[发生规律](attribute)吗”，该例中NLU模块会提取值为“玉米细菌性茎腐病”的“虫害”实体以及值为“发生规律”的attribute实体，调用utter_attribute_value()方法，虫害实体用于确定对象是哪一个，attribute实体用于确定要查询的属性。

### 4.3 解释指代

#### 4.3.1 序数指代

​		将“第一个”，“第3个”等词映射到列表中的索引对象。

#### 4.3.2 代词指代

​		将“它”，“这个”等词映射为对话中最后提及的对象，该方法在复杂情况下并不适用。

### 4.4 Neo4j查询

​		使用Neo4j的API通过构建Cypher语法来查询知识图谱。



